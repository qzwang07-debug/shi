## 修改后台图片上传到阿里云OSS计划

### 修改文件列表

#### 1. 修改 SysProfileController.java（用户头像上传）

**文件路径**: `d:\code\zNova\zNova-admin\src\main\java\com\zNova\web\controller\system\SysProfileController.java`

**修改内容**:

* 添加 `FileStorageService` 和相关导入

* 修改 `avatar` 方法，使用 `fileStorageService` 上传到OSS

* 修改旧头像删除逻辑（兼容OSS URL格式）

**关键变更**:

```java
// 原代码（本地存储）
String avatar = FileUploadUtils.upload(RuoYiConfig.getAvatarPath(), file, MimeTypeUtils.IMAGE_EXTENSION, true);

// 新代码（OSS存储）
String objectPath = "avatar/" + LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd")) + "/";
FileInfo fileInfo = fileStorageService.of(file).setPath(objectPath).upload();
String avatar = fileInfo.getUrl();
```

#### 2. 修改 CommonController.java（多文件上传）

**文件路径**: `d:\code\zNova\zNova-admin\src\main\java\com\zNova\web\controller\common\CommonController.java`

**修改内容**:

* 修改 `uploadFiles` 方法，使用 `fileStorageService` 上传到OSS

* 保持与单文件上传一致的存储逻辑

**关键变更**:

```java
// 原代码（本地存储）
String fileName = FileUploadUtils.upload(filePath, file);
String url = serverConfig.getUrl() + fileName;

// 新代码（OSS存储）
String objectName = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy/MM/dd")) + "/";
FileInfo fileInfo = fileStorageService.of(file).setPath(objectName).upload();
String url = fileInfo.getUrl();
```

### 实施步骤

1. **修改 SysProfileController.java**

   * 添加必要的 import 语句（FileStorageService、FileInfo、LocalDate、DateTimeFormatter）

   * 注入 FileStorageService

   * 重写 avatar 方法实现OSS上传

2. **修改 CommonController.java**

   * 重写 uploadFiles 方法实现OSS上传

### 预期效果

* 用户头像将存储到阿里云OSS

* 后台上传的图片文件将统一存储到云端

* 与App用户端保持一致的存储策略

* 解决本地存储导致的头像显示问题

